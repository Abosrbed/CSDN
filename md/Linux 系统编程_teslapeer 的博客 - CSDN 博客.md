> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [blog.csdn.net](https://blog.csdn.net/qq_53099212/article/details/132452987?spm=1001.2014.3001.5502)

#### Linux ç³»ç»Ÿç¼–ç¨‹ç›®å½•

*   [Linux å¼€å‘ç¯å¢ƒ](#Linux_2)
*   [GCC](#GCC_4)
*   *   [ä»€ä¹ˆæ˜¯ GCC](#GCC_5)
    *   [GCC å·¥ä½œæµç¨‹](#GCC_22)
    *   [GCC å¸¸ç”¨å‘½ä»¤](#GCC_34)
*   [é™æ€åº“ä¸åŠ¨æ€åº“](#_76)
*   *   [ä»€ä¹ˆæ˜¯åº“](#_77)
    *   [é™æ€åº“](#_82)
    *   *   [é™æ€åº“çš„å‘½åè§„åˆ™](#_83)
        *   [é™æ€åº“çš„åˆ¶ä½œ](#_86)
        *   [é™æ€åº“çš„ä½¿ç”¨](#_98)
    *   [åŠ¨æ€åº“](#_125)
    *   *   [åŠ¨æ€åº“çš„å‘½åè§„åˆ™](#_126)
        *   [åŠ¨æ€åº“çš„åˆ¶ä½œ](#_129)
        *   [åŠ¨æ€åº“çš„ä½¿ç”¨](#_139)
    *   [é™æ€åº“å’ŒåŠ¨æ€åº“çš„åŒºåˆ«](#_231)
    *   *   [é™æ€åº“ä¼˜ç¼ºç‚¹](#_233)
        *   [åŠ¨æ€åº“ä¼˜ç¼ºç‚¹](#_243)
*   [Makefile](#Makefile_254)
*   *   [ä»€ä¹ˆæ˜¯ Makefile](#Makefile_255)
    *   [Makefile æ–‡ä»¶çš„å‘½åè§„åˆ™](#Makefile__261)
    *   [Makefile å·¥ä½œåŸç†](#Makefile__286)
    *   [Makefile å˜é‡](#Makefile__306)
    *   *   [è‡ªå®šä¹‰å˜é‡](#_307)
        *   [å¸¸ç”¨é¢„å®šä¹‰å˜é‡](#_312)
        *   [è·å–å˜é‡å€¼](#_321)
        *   [å˜é‡ä½¿ç”¨](#_326)
        *   [å˜é‡åŒ¹é…](#_338)
    *   [Makefile å¸¸ç”¨å‡½æ•°](#Makefile__356)
*   [GDB](#GDB_379)
*   *   [ä»€ä¹ˆæ˜¯ GDB](#GDB_380)
    *   [è°ƒè¯•å‰å‡†å¤‡å·¥ä½œ](#_386)
    *   [GDB å¸¸ç”¨å‘½ä»¤åŠä½¿ç”¨](#GDB_441)
    *   *   [åŸºç¡€å‘½ä»¤](#_442)
        *   [æ–­ç‚¹å‘½ä»¤](#_514)
        *   [è°ƒè¯•å‘½ä»¤](#_542)
        *   [å˜é‡è‡ªåŠ¨æ“ä½œ](#_567)
*   [æ ‡å‡† C åº“ IO å‡½æ•°å’Œ Linux ç³»ç»Ÿ IO å‡½æ•°å¯¹æ¯”](#_C__IO__Linux__IO__577)
*   *   [æ ‡å‡† C åº“ IO å‡½æ•°](#_C__IO__587)
    *   [æ ‡å‡† C åº“ IO å‡½æ•°å’Œ Linux ç³»ç»Ÿ IO å‡½æ•°å·¥ä½œæµç¨‹](#_C__IO__Linux__IO__590)
    *   [è¯¦ç»†å¯¹æ¯”](#_592)
*   [è™šæ‹Ÿåœ°å€ç©ºé—´](#_607)
*   [æ–‡ä»¶æè¿°ç¬¦](#_612)
*   [openã€close å‡½æ•°](#openclose__618)
*   [readã€write å‡½æ•°](#readwrite__703)
*   [lseek å‡½æ•°](#lseek__760)
*   [statã€lstat å‡½æ•°](#statlstat__814)
*   *   [stat ç»“æ„ä½“](#stat__860)
    *   [st_mode å˜é‡](#st_mode__880)
    *   [è½¯é“¾æ¥ä¸ç¡¬é“¾æ¥](#_884)
    *   [è½¯é“¾æ¥æ–‡ä»¶çš„åˆ›å»º](#_905)
    *   [æ¨¡æ‹Ÿå®ç° ls -l å‘½ä»¤](#_ls_l__922)
*   [æ–‡ä»¶å±æ€§æ“ä½œå‡½æ•°](#_1038)
*   *   [access å‡½æ•°](#access_1039)
    *   [chomd å‡½æ•°](#chomd__1066)
    *   [chown å‡½æ•°](#chown__1096)
    *   [truncate å‡½æ•°](#truncate__1114)
*   [ç›®å½•æ“ä½œå‡½æ•°](#_1142)
*   *   [mkdir å‡½æ•°](#mkdir__1143)
    *   [rmdir å‡½æ•°](#rmdir__1169)
    *   [rename å‡½æ•°](#rename__1176)
    *   [chdir å‡½æ•°](#chdir__1200)
    *   [getcwd å‡½æ•°](#getcwd__1207)
*   [ç›®å½•éå†å‡½æ•°](#_1254)
*   *   [opendir å‡½æ•°](#opendir__1255)
    *   [readdir å‡½æ•°](#readdir__1262)
    *   *   [dirent ç»“æ„ä½“](#dirent_1268)
        *   [d_type å˜é‡](#d_type__1279)
    *   [closedir å‡½æ•°](#closedir__1283)
*   [dupã€dup2 å‡½æ•°](#dupdup2__1362)
*   [fcntl å‡½æ•°](#fcntl__1461)
*   [ç»“è¯­](#_1524)

Linux å¼€å‘ç¯å¢ƒ
----------

ç•¥

[GCC](https://so.csdn.net/so/search?q=GCC&spm=1001.2101.3001.7020)
------------------------------------------------------------------

### ä»€ä¹ˆæ˜¯ GCC

> **GCCï¼ˆGNU Compiler Collectionï¼‰æ˜¯ä¸€å¥—ç”± GNU é¡¹ç›®å¼€å‘çš„å¼€æºç¼–è¯‘å™¨é›†åˆã€‚**

**å®‰è£…å‘½ä»¤**

```
sudo apt install gcc g++

```

**æŸ¥çœ‹ç‰ˆæœ¬**

```
gcc -v #g++ -v
gcc --version #g++ --version

```

**æ³¨æ„**ï¼šgcc/g++ ç‰ˆæœ¬éœ€è¦ 4.8.5 ä»¥ä¸Šï¼Œå¦åˆ™æ— æ³•ç¼–è¯‘ C++11ã€‚

### GCC å·¥ä½œæµç¨‹

GCC çš„å·¥ä½œæµç¨‹ä¸ C/C++ çš„ç¼–è¯‘è¿‡ç¨‹ç›¸åŒï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼š

å¯åŠ¨ä»£ç  é“¾æ¥å™¨ åº“ä»£ç  æºä»£ç   
.h/.c/.cpp é¢„å¤„ç†å™¨ é¢„å¤„ç†åæºä»£ç   
.i ç¼–è¯‘å™¨ æ±‡ç¼–ä»£ç   
.s æ±‡ç¼–å™¨ ç›®æ ‡ä»£ç   
.o å¯æ‰§è¡Œç¨‹åº  
.exe/.out å…¶ä»–ç›®æ ‡ä»£ç 

### GCC å¸¸ç”¨å‘½ä»¤

**è¯­æ³•**

```
gcc [é€‰é¡¹] 
g++ [é€‰é¡¹] 

```

**å¸¸ç”¨é€‰é¡¹**

<table><thead><tr><th>é€‰é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>-E</code></td><td>åªé¢„å¤„ç†æŒ‡å®šæºæ–‡ä»¶ï¼Œä¸ç¼–è¯‘</td></tr><tr><td><code>-S</code></td><td>ç¼–è¯‘æŒ‡å®šæºæ–‡ä»¶ï¼Œä¸æ±‡ç¼–</td></tr><tr><td><code>-c</code></td><td>ç¼–è¯‘ã€æ±‡ç¼–æŒ‡å®šæºæ–‡ä»¶ï¼Œä¸é“¾æ¥</td></tr><tr><td><code>-o</code></td><td>è¾“å‡ºåˆ°</td></tr><tr><td><code>-On</code></td><td>n çš„èŒƒå›´æ˜¯ 1~3ï¼Œæ•°å­—è¶Šå¤§ä¼˜åŒ–çº§åˆ«è¶Šé«˜ç¼–è¯‘æ—¶é—´è¶Šé•¿ï¼ˆO æ˜¯å¤§å†™ oï¼‰</td></tr><tr><td><code>-I</code></td><td>ç¼–è¯‘æ—¶æŒ‡å®šä½¿ç”¨çš„å¤´æ–‡ä»¶</td></tr><tr><td><code>-l</code></td><td>ç¼–è¯‘æ—¶æŒ‡å®šä½¿ç”¨çš„åº“</td></tr><tr><td><code>-L</code></td><td>æŒ‡å®šç¼–è¯‘æ—¶æœç´¢åº“çš„è·¯å¾„</td></tr><tr><td><code>-g</code></td><td>ç¼–è¯‘æ—¶ç”Ÿæˆè°ƒè¯•ä¿¡æ¯ï¼Œè¡¨ç¤ºè¯¥ç¨‹åºå¯ä»¥è¢«è°ƒè¯•å™¨è°ƒè¯•</td></tr><tr><td><code>-D</code></td><td>åœ¨ç¼–è¯‘æ—¶æŒ‡å®šä¸€ä¸ªå®</td></tr><tr><td><code>-fpic</code></td><td>ç”Ÿæˆä¸ä½ç½®æ— å…³çš„ä»£ç </td></tr><tr><td><code>-shared</code></td><td>ç”Ÿæˆå…±äº«ç›®æ ‡æ–‡ä»¶</td></tr><tr><td><code>-std=</code></td><td>æŒ‡å®šè¯­è¨€æ ‡å‡†</td></tr><tr><td><code>-w</code></td><td>ä¸ç”Ÿæˆä»»ä½•è­¦å‘Š</td></tr><tr><td><code>-Wall</code></td><td>ç”Ÿæˆæ‰€æœ‰è­¦å‘Š</td></tr></tbody></table>

**ä»£ç ç¤ºä¾‹**

```
# åˆ†æ­¥ç¼–è¯‘
gcc -E main.c -o main.i
gcc -S main.i -o main.s
gcc -c main.s -o main.o
gcc main.o -o main

# ä¸€æ­¥åˆ°ä½
gcc main.c -o main

#å¤šæ–‡ä»¶ç¼–è¯‘
gcc test.c main.c -o main

```

é™æ€åº“ä¸åŠ¨æ€åº“
-------

### ä»€ä¹ˆæ˜¯åº“

> **åº“æ˜¯è®¡ç®—æœºä¸Šçš„ä¸€ç±»æä¾›ç›´æ¥ä½¿ç”¨çš„å˜é‡ã€å‡½æ•°ã€ç±»çš„æ–‡ä»¶ã€‚**  
> åº“ç®—æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç¨‹åºä½†ä¸èƒ½å•ç‹¬è¿è¡Œå¯ä»¥çœ‹æˆä¸€ç§ä»£ç ä»“åº“ã€‚  
> åº“å…·æœ‰**ä¿å¯†ä»£ç **ã€**æ–¹ä¾¿éƒ¨ç½²å’Œåˆ†å‘**çš„ä½œç”¨ã€‚

### é™æ€åº“

#### é™æ€åº“çš„å‘½åè§„åˆ™

1.  Linuxï¼š`libxxx.a`
2.  Windowsï¼š`libxxx.lib`

#### é™æ€åº“çš„åˆ¶ä½œ

1.  `gcc` è·å¾— `.o` æ–‡ä»¶
2.  ä½¿ç”¨ `ar` å·¥å…·ï¼ˆarchiveï¼‰å°† `.o` æ–‡ä»¶æ‰“åŒ…

**ä»£ç ç¤ºä¾‹**  
`r` - å°†æ–‡ä»¶æ’å…¥å¤‡å­˜æ–‡ä»¶ä¸­  
`c` - å»ºç«‹å¤‡å­˜æ–‡ä»¶  
`s` - ç´¢å¼•

```
# å¯ä»¥æ‰“åŒ…å¤šä¸ª.o æ–‡ä»¶
ar rcs libxxx.a xxx.o

```

#### é™æ€åº“çš„ä½¿ç”¨

é“¾æ¥æ—¶é¡»æ³¨æ„å¤´æ–‡ä»¶çš„å±•å¼€å’Œåº“æ–‡ä»¶çš„åŠ è½½ï¼Œå¦å¤–è¿˜éœ€æ³¨æ„ç›®å½•å±‚çº§ã€‚

**ä»£ç ç¤ºä¾‹**  
ç°æœ‰ä¸€ä¸ªä»¥æ‰“åŒ…çš„é™æ€åº“æ–‡ä»¶ library ï¼Œå…¶åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

```
.
â”œâ”€ include
â”‚	â””â”€ head.h
â”œâ”€ lib
â”‚	â””â”€ libcalculate.a
â”œâ”€ main.c
â””â”€ src
	â”œâ”€ add.c
	â”œâ”€ div.c
	â”œâ”€ mult.c
	â””â”€ sub.c

```

ä½¿ç”¨è¯­æ³•å¦‚ä¸‹ï¼š

```
#å¤„ç†
gcc main.c -o app -I ./include/ -l calculate -L ./lib/
#ä½¿ç”¨
./app

```

### åŠ¨æ€åº“

#### åŠ¨æ€åº“çš„å‘½åè§„åˆ™

*   Linuxï¼š`libxxx.so` ï¼ˆLinux ä¸‹æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼‰
*   Windowsï¼š`libxxx.dll`

#### åŠ¨æ€åº“çš„åˆ¶ä½œ

1.  `gcc` è·å¾— `.o` æ–‡ä»¶ï¼Œå¾—åˆ°å’Œä½ç½®æ— å…³çš„ä»£ç 
2.  `gcc` è·å¾—åŠ¨æ€åº“

**ä»£ç ç¤ºä¾‹**  
`-fpic` ç”¨äºæ±‡ç¼–é˜¶æ®µï¼Œäº§ç”Ÿçš„ç›®æ ‡æ–‡ä»¶æ²¡æœ‰ç»å¯¹åœ°å€ï¼Œå…¨éƒ¨ç”¨ç›¸å¯¹åœ°å€ï¼Œè¿™æ­£å¥½æ»¡è¶³äº†å…±äº«åº“çš„è¦æ±‚ï¼Œå…±äº«åº“è¢«åŠ è½½æ—¶åœ°å€ä¸æ˜¯å›ºå®šçš„ã€‚å¦‚æœä¸åŠ  `-fpic` ï¼Œé‚£ä¹ˆç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å°±ä¼šä¸ä½ç½®æœ‰å…³ï¼Œå½“è¿›ç¨‹ä½¿ç”¨è¯¥ `.so` æ–‡ä»¶æ—¶éƒ½éœ€è¦é‡å®šä½ï¼Œä¸”ä¼šäº§ç”Ÿæˆè¯¥æ–‡ä»¶çš„å‰¯æœ¬ï¼Œæ¯ä¸ªå‰¯æœ¬éƒ½ä¸åŒï¼Œä¸åŒç‚¹å–å†³äºè¯¥æ–‡ä»¶ä»£ç æ®µä¸æ•°æ®æ®µæ‰€æ˜ å°„å†…å­˜çš„ä½ç½®ã€‚

```
gcc -c -fpic test.c
gcc -shared test.o -o libcalculate.so

```

#### åŠ¨æ€åº“çš„ä½¿ç”¨

åœ¨ linux ç›®å½•ä¸‹ï¼ŒåŠ¨æ€åº“æ–‡ä»¶å­—ä½“é¢œè‰²ä¸ºç»¿è‰²ï¼Œç»è¿‡å¤„ç†åçš„åŠ¨æ€åº“ä¼šåœ¨ç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åºåæ·»åŠ ä¸€ä¸ª * å·ã€‚  
ç”±äº GCC è¿›è¡Œé“¾æ¥æ—¶æ— æ³•å°†åŠ¨æ€åº“ä»£ç æ‰“åŒ…åˆ°å¯æ‰§è¡Œç¨‹åºä¸­ã€‚å¯åŠ¨ç¨‹åºååŠ¨æ€åº“ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œé€šè¿‡ `lld` å‘½ä»¤æ£€æŸ¥åŠ¨æ€åº“ä¾èµ–å…³ç³»ã€‚  
**å¦‚ä½•å®šä½å…±äº«åº“æ–‡ä»¶**  
å½“ç³»ç»ŸåŠ è½½å¯æ‰§è¡Œä»£ç æ—¶ï¼Œèƒ½å¤ŸçŸ¥é“æ‰€ä¾èµ–åº“çš„åå­—ï¼Œä½†è¿˜æ˜¯éœ€è¦çŸ¥é“ç»å¯¹è·¯å¾„ã€‚ç³»ç»Ÿçš„åŠ¨æ€è½½å…¥å™¨å¯ä»¥è·å–è¯¥ç»å¯¹è·¯å¾„ã€‚  
elf æ ¼å¼çš„å¯æ‰§è¡Œç¨‹åºæ˜¯ç”± ld-linux.so æ¥å®Œæˆçš„ï¼Œå®ƒå…ˆåæœç´¢ elf æ–‡ä»¶çš„ `DT_RPATH æ®µ` â†’ `ç¯å¢ƒå˜é‡LD_LIBRARY_PATH` â†’ `/etc/ld.so.cache æ–‡ä»¶åˆ—è¡¨` â†’ `/lib/ï¼Œ/usr/lib ç›®å½•`æ‰¾åˆ°åº“æ–‡ä»¶åå°†å…¶è½½å…¥å†…å­˜ã€‚

**ä»£ç ç¤ºä¾‹**  
ç°æœ‰ä¸€ä¸ªä»¥æ‰“åŒ…çš„é™æ€åº“æ–‡ä»¶ library ï¼Œå…¶åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

```
.
â”œâ”€ include
â”‚	â””â”€ head.h
â”œâ”€ lib
â”‚	â””â”€ libcalculate.so
â”œâ”€ main.c
â””â”€ src
	â”œâ”€ add.c
	â”œâ”€ div.c
	â”œâ”€ mult.c
	â””â”€ sub.c

```

**ä½¿ç”¨è¯­æ³•å¦‚ä¸‹**ï¼š

*   ä¸´æ—¶é…ç½®ï¼ˆç»ˆç«¯é…ç½®ååˆ‡æ¢ Xshell é“¾æ¥ä¼šæŠ¥é”™ï¼‰

```
# å¤„ç†ç”Ÿæˆappæ–‡ä»¶ï¼ˆappéå¿…å®šåå­—ï¼‰
gcc main.c -o app -I ./include/ -l calculate -L ./lib/

# é…ç½®ç¯å¢ƒå˜é‡ï¼Œå€¼ä¸ºlibæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼ˆlibæ–‡ä»¶å¤¹ä¸‹ç”¨pwdæŒ‡ä»¤è¾“å‡ºç»å¯¹è·¯å¾„ï¼‰
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:libæ–‡ä»¶çš„ç»å¯¹è·¯å¾„

# åœ¨å¤„ç†åç”Ÿæˆçš„appæ–‡ä»¶ä¸‹ç”¨lldæŒ‡ä»¤ï¼Œå¦‚æœlibcalculate.soä»¥åˆ†é…å†…å­˜ä¸”è·¯å¾„åœ¨libæ–‡ä»¶å¤¹ä¸‹åˆ™é“¾æ¥æˆåŠŸ
ldd app

```

*   æ°¸ä¹…é…ç½® 1ï¼ˆç”¨æˆ·çº§ï¼‰

```
# å¤„ç†ç”Ÿæˆappæ–‡ä»¶ï¼ˆappéå¿…å®šåå­—ï¼‰
gcc main.c -o app -I ./include/ -l calculate -L ./lib/

# åˆ‡å…¥homeæ–‡ä»¶ä¸‹æ‰¾åˆ°.bashrcæ–‡ä»¶ä¿®æ”¹
cd home
ll
vim .bashrc

# åœ¨.bashrcæ–‡ä»¶æœ€åä¸€è¡Œæ’å…¥ä»¥ä¸‹æŒ‡ä»¤
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:libæ–‡ä»¶çš„ç»å¯¹è·¯å¾„

# ç”Ÿæ•ˆæ›´æ–°
. .bashrc # source .bashrc

# åœ¨å¤„ç†åç”Ÿæˆçš„appæ–‡ä»¶ä¸‹ç”¨lldæŒ‡ä»¤ï¼Œå¦‚æœlibcalculate.soä»¥åˆ†é…å†…å­˜ä¸”è·¯å¾„åœ¨libæ–‡ä»¶å¤¹ä¸‹åˆ™é“¾æ¥æˆåŠŸ
ldd app

```

*   æ°¸ä¹…é…ç½® 2ï¼ˆç³»ç»Ÿçº§ï¼‰

```
# å¤„ç†ç”Ÿæˆappæ–‡ä»¶ï¼ˆappéå¿…å®šåå­—ï¼‰
gcc main.c -o app -I ./include/ -l calculate -L ./lib/

# ç”¨ç®¡ç†å‘˜èº«ä»½è¿›å…¥ç³»ç»Ÿå˜é‡è®¾ç½®æ–‡ä»¶
sudo vim /etc/profile

# åœ¨profileæ–‡ä»¶æœ€åä¸€è¡Œæ’å…¥ä»¥ä¸‹æŒ‡ä»¤
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:libæ–‡ä»¶çš„ç»å¯¹è·¯å¾„

# ç”Ÿæ•ˆæ›´æ–°
. /etc/profile # source /etc/profile

# åœ¨å¤„ç†åç”Ÿæˆçš„appæ–‡ä»¶ä¸‹ç”¨lldæŒ‡ä»¤ï¼Œå¦‚æœlibcalculate.soä»¥åˆ†é…å†…å­˜ä¸”è·¯å¾„åœ¨libæ–‡ä»¶å¤¹ä¸‹åˆ™é“¾æ¥æˆåŠŸ
ldd app

```

*   æ°¸ä¹…é…ç½® 3ï¼ˆç³»ç»Ÿçº§ï¼Œä¾¿æ·ï¼‰

```
# å¤„ç†ç”Ÿæˆappæ–‡ä»¶ï¼ˆappéå¿…å®šåå­—ï¼‰
gcc main.c -o app -I ./include/ -l calculate -L ./lib/

# ç”±äº/etc/ld.so.cacheæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬é—´æ¥ä¿®æ”¹/etc/ld.so.confæ–‡ä»¶ï¼šæ’å…¥libæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ä¿å­˜å³å¯
sudo vim /etc/ld.so.conf

# ç”Ÿæ•ˆæ›´æ–°
sudo ldconfig

# åœ¨å¤„ç†åç”Ÿæˆçš„appæ–‡ä»¶ä¸‹ç”¨lldæŒ‡ä»¤ï¼Œå¦‚æœlibcalculate.soä»¥åˆ†é…å†…å­˜ä¸”è·¯å¾„åœ¨libæ–‡ä»¶å¤¹ä¸‹åˆ™é“¾æ¥æˆåŠŸ
ldd app

```

*   æ°¸ä¹…é…ç½® 4ï¼ˆç³»ç»Ÿçº§ï¼Œä½†æ˜¯ / lib/ï¼Œ/usr/lib ç›®å½•ä¸‹å¤ªå¤šæ–‡ä»¶ä¸å»ºè®®é…ç½®ï¼‰

### é™æ€åº“å’ŒåŠ¨æ€åº“çš„åŒºåˆ«

é™æ€åº“ã€åŠ¨æ€åº“åŒºåˆ«æ¥è‡ªé“¾æ¥é˜¶æ®µå¦‚ä½•å¤„ç†é“¾æ¥æˆå¯æ‰§è¡Œç¨‹åºã€‚åˆ†ä¸ºé™æ€é“¾æ¥æ–¹å¼å’ŒåŠ¨æ€é“¾æ¥æ–¹å¼ã€‚

#### é™æ€åº“ä¼˜ç¼ºç‚¹

*   **ä¼˜ç‚¹**
    
    *   é™æ€åº“è¢«æ‰“åŒ…åˆ°åº”ç”¨ç¨‹åºä¸­åŠ è½½é€Ÿåº¦å¿«ã€‚
    *   å‘å¸ƒç¨‹åºæ— éœ€é¢å¤–æä¾›é™æ€åº“ï¼Œç§»æ®–æ–¹ä¾¿ã€‚
*   **ç¼ºç‚¹**
    
    *   æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œæµªè´¹å†…å­˜ã€‚
    *   æ›´æ–°ã€éƒ¨ç½²ã€å‘å¸ƒéº»çƒ¦ã€‚

#### åŠ¨æ€åº“ä¼˜ç¼ºç‚¹

*   **ä¼˜ç‚¹**
    
    *   å¯ä»¥å®ç°è¿›ç¨‹é—´èµ„æºå…±äº«ï¼ˆå…±äº«åº“ï¼‰ã€‚
    *   æ›´æ–°ã€éƒ¨ç½²ã€å‘å¸ƒç®€å•ã€‚
    *   åŠ è½½åŠ¨æ€åº“æ—¶é—´å¯æ§ã€‚
*   **ç¼ºç‚¹**
    
    *   åŠ è½½é€Ÿåº¦ç›¸å¯¹äºé™æ€åº“æ…¢ã€‚
    *   å‘å¸ƒç¨‹åºæ—¶éœ€è¦æä¾›ä¾èµ–çš„åŠ¨æ€åº“ã€‚

Makefile
--------

### ä»€ä¹ˆæ˜¯ Makefile

> **Makefile æ˜¯ä¸€ç§ç”¨äºç®¡ç†å’Œè‡ªåŠ¨åŒ–è½¯ä»¶é¡¹ç›®ç¼–è¯‘ã€æ„å»ºå’Œéƒ¨ç½²è¿‡ç¨‹çš„æ–‡æœ¬æ–‡ä»¶ã€‚**  
> Makefile çš„å¥½å¤„å°±æ˜¯ â€œè‡ªåŠ¨åŒ–ç¼–è¯‘â€ï¼Œåªéœ€ä¸€ä¸ª make å‘½ä»¤æ•´ä¸ªå·¥ç¨‹å®Œå…¨è‡ªåŠ¨ç¼–è¯‘æå¤§åœ°æé«˜äº†è½¯ä»¶å¼€å‘æ•ˆç‡ã€‚  
> make æ˜¯ä¸€ä¸ªè§£é‡Š Makefile æ–‡ä»¶ä¸­æŒ‡ä»¤çš„å‘½ä»¤å·¥å…·ã€‚

### Makefile æ–‡ä»¶çš„å‘½åè§„åˆ™

*   **å‘½å**ï¼šmakefile æˆ– Makefile
*   **è§„åˆ™**ï¼šä¸€ä¸ª Makefile æ–‡ä»¶ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè§„åˆ™

**ä»£ç ç¤ºä¾‹**

**ç›®æ ‡**ï¼šæœ€ç»ˆè¦ç”Ÿæˆçš„æ–‡ä»¶ï¼ˆä¼ªç›®æ ‡æ–‡ä»¶ä¸ç®—ï¼‰  
**ä¼ªç›®æ ‡**ï¼šä¸€ç§ç‰¹æ®Šç›®æ ‡ä¸”ä¸ç”Ÿæˆæ–‡ä»¶ï¼Œè€Œæ˜¯è¡¨ç¤ºä¸€ç»„å‘½ä»¤çš„é›†åˆ  
**ä¾èµ–**ï¼šç”Ÿæˆç›®æ ‡æ‰€éœ€æ–‡ä»¶æˆ–æ˜¯ç›®æ ‡  
**å‘½ä»¤**ï¼šé€šè¿‡æ‰§è¡Œå‘½ä»¤å¯¹ä¾èµ–æ“ä½œç”Ÿæˆç›®æ ‡ï¼ˆå‘½ä»¤è¡Œå‰å¿…é¡» Tab ç¼©è¿›ï¼‰

```
# ç›®æ ‡æ–‡ä»¶:ä¾èµ–æ–‡ä»¶
#     å‘½ä»¤(shell)
#     ...
# .PHONY:ä¼ªç›®æ ‡

app:sub.c add.c mult.c div.c main.c
	gcc sub.c add.c mult.c div.c main.c -o app
.PHONY:clean
clean:
    rm -f *.o my_program

```

åœ¨å½“å‰ç›®å½•ä¸‹é”®å…¥ `make` æŒ‡ä»¤æ‰§è¡Œ Makefile æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šç›®æ ‡ï¼Œ `make` é»˜è®¤ä¼šæ‰§è¡Œ Makefile ä¸­çš„ç¬¬ä¸€ä¸ªç›®æ ‡ã€‚

### Makefile å·¥ä½œåŸç†

**1. æ‰§è¡Œå‘½ä»¤å‰æ£€æŸ¥è§„åˆ™**

æ˜¯ å¦ å¦ æ˜¯ æ‰§è¡Œå‘½ä»¤å‰ æ£€æŸ¥è§„åˆ™ è§„åˆ™ä¸­  
ä¾èµ–æ˜¯å¦å­˜åœ¨ æ‰§è¡Œå‘½ä»¤ å‘ä¸‹æ£€æŸ¥è§„åˆ™ æ˜¯å¦æœ‰å…¶ä»–è§„åˆ™  
ç”¨æ¥ç”Ÿæˆä¾èµ– æ‰§è¡Œè¯¥è§„åˆ™å‘½ä»¤

**2. æ‰§è¡Œå‘½ä»¤æ—¶æ£€æµ‹æ›´æ–°**

æ˜¯ å¦ æ‰§è¡Œå‘½ä»¤æ—¶ æ¯”è¾ƒç›®æ ‡å’Œä¾èµ–çš„æ—¶é—´ ç›®æ ‡æ˜¯å¦æ¯”ä¾èµ–æ™š ä¸æ›´æ–°ç›®æ ‡  
å¯¹åº”è§„åˆ™å‘½ä»¤ä¸æ‰§è¡Œ é‡æ–°ç”Ÿæˆç›®æ ‡

### Makefile å˜é‡

#### è‡ªå®šä¹‰å˜é‡

**è¯­æ³•**ï¼š`å˜é‡å = å˜é‡å€¼`

```
var = hello

```

#### å¸¸ç”¨é¢„å®šä¹‰å˜é‡

<table><thead><tr><th>é¢„å®šä¹‰å˜é‡å</th><th>å«ä¹‰</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><code>AR</code></td><td>å½’æ¡£ç»´æŠ¤ç¨‹åºçš„åç§°</td><td>ar</td></tr><tr><td><code>CC</code></td><td>C ç¼–è¯‘å™¨çš„åç§°</td><td>cc</td></tr><tr><td><code>CXX</code></td><td>C++ ç¼–è¯‘å™¨çš„åç§°</td><td>g++</td></tr><tr><td><code>$@</code></td><td>ç›®æ ‡æ–‡ä»¶çš„å®Œæ•´åç§°</td><td></td></tr><tr><td><code>$&lt;</code></td><td>ç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶çš„åç§°</td><td></td></tr><tr><td><code>$^</code></td><td>æ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶</td><td></td></tr></tbody></table>

#### è·å–å˜é‡å€¼

**è¯­æ³•**ï¼š`$(å˜é‡å)`

```
$(var)

```

#### å˜é‡ä½¿ç”¨

è‡ªåŠ¨å˜é‡åªèƒ½åœ¨è§„åˆ™çš„å‘½ä»¤ä¸­ä½¿ç”¨

```
app:main.c a.c b.c
	gcc -c main.c a.c b.c -o app

# ä»¥ä¸Šä»£ç ç­‰åŒäºä»¥ä¸‹ä»£ç 
src=main.c a.c b.c
target=app
$(target):$(src)
	$(CC) -c $^ -o $@

```

#### å˜é‡åŒ¹é…

**å¸¸ç”¨åŒ¹é…è§„åˆ™**

<table><thead><tr><th>é€šé…ç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>*</code></td><td>åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</td></tr><tr><td><code>?</code></td><td>åŒ¹é…ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td><code>%</code></td><td>åŒ¹é…ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆä¸¤ä¸ª <code>%</code> åŒ¹é…çš„æ˜¯åŒä¸€ä¸ªå­—ç¬¦ä¸²ï¼‰</td></tr><tr><td><code>[...]</code></td><td>åŒ¹é…æ–¹æ‹¬å·å†…çš„ä»»ä½•ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td><code>[^...]</code></td><td>åŒ¹é…é™¤æ–¹æ‹¬å·å†…å­—ç¬¦ä¹‹å¤–çš„ä»»ä½•ä¸€ä¸ªå­—ç¬¦</td></tr></tbody></table>

**ä»£ç ç¤ºä¾‹**

```
# å°†æ‰€æœ‰ .c æ–‡ä»¶ç¼–è¯‘ä¸ºç›¸åº”çš„ .o æ–‡ä»¶
%.o: %.c
    $(CC)  -c $< -o $@

```

### Makefile å¸¸ç”¨å‡½æ•°

**1.`$(wildcard PATTERN)`**

*   **ä½œç”¨**ï¼šè·å–æŒ‡å®šç›®å½•ä¸‹æŒ‡å®šç±»å‹çš„æ–‡ä»¶åˆ—è¡¨ã€‚
*   **å‚æ•°**ï¼šPATTERN æŒ‡ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆç©ºæ ¼éš”å¼€ï¼‰å¯¹åº”æŸç§ç±»å‹çš„æ–‡ä»¶ã€‚
*   **è¿”å›**ï¼šå¾—åˆ°å¯¹åº”åŒ¹é…çš„æ–‡ä»¶åˆ—è¡¨ã€‚

**ä»£ç ç¤ºä¾‹**

```
$(wildcard *.c ./lib/*.c)

```

**2.`$(patsubst PATTERN,REPLACEMENT,TEXT)`**

*   **ä½œç”¨**ï¼šå¦‚æœ TEXT ä¸ PATTERN åŒ¹é…ï¼Œåˆ™ç”¨ REPLACEMENT å¯¹åº”æ›¿æ¢ TEXT ã€‚
*   **å‚æ•°**ï¼šPATTERN æ˜¯æŒ‡åŒ¹é…è§„åˆ™ï¼ŒREPLACEMENT æ˜¯æŒ‡æ›¿æ¢åå­—ç¬¦ä¸²ï¼ŒTEXT å¾…æ›¿æ¢å­—ç¬¦ä¸²ã€‚
*   **è¿”å›**ï¼šè¢«æ›¿æ¢åçš„å­—ç¬¦ä¸²ã€‚

**ä»£ç ç¤ºä¾‹**

```
$(patsubst %.c,%.o,add.c sub.c mult.c div.c)

```

GDB
---

### ä»€ä¹ˆæ˜¯ GDB

> **GDB(GNU Debugger) æ˜¯ä¸€ç§ç”¨äºè°ƒè¯•ç¨‹åºçš„å¼€æºè°ƒè¯•å·¥å…·ã€‚**  
> GDB åŒ GCC é…å¥—ç»„æˆäº†ä¸€å¥—å®Œæ•´çš„å¼€å‘ç¯å¢ƒï¼Œæ˜¯ Linux å’Œè®¸å¤šç±» Unix ç³»ç»Ÿä¸­çš„æ ‡å‡†å¼€å‘ç¯å¢ƒã€‚  
> GDB ä¸»è¦æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼šè‡ªå®šä¹‰å¯åŠ¨å’Œè¿è¡Œç¨‹åºã€åœ¨æ–­ç‚¹å¤„æš‚åœè¿è¡Œå¹¶æ£€æŸ¥ã€æ”¹å˜ç¨‹åºä¿®æ­£ BUGã€‚

### è°ƒè¯•å‰å‡†å¤‡å·¥ä½œ

å…³æ‰[ç¼–è¯‘å™¨ä¼˜åŒ–](https://so.csdn.net/so/search?q=%E7%BC%96%E8%AF%91%E5%99%A8%E4%BC%98%E5%8C%96&spm=1001.2101.3001.7020)é€‰é¡¹ `-On` ï¼Œå¹¶æ‰“å¼€è°ƒè¯•é€‰é¡¹ `-g` ï¼Œå¦å¤–å°½é‡åœ¨ä¸å½±å“ç¨‹åºè¡Œä¸ºçš„æƒ…å†µä¸‹æ‰“å¼€é€‰é¡¹`-Wall`ï¼Œæ˜¾ç¤ºæ‰€æœ‰ warningã€‚

**ä»£ç ç¤ºä¾‹**  
æºæ–‡ä»¶ test.c

```
//test.c
#include <stdio.h>
#include <stdlib.h>
 
int test(int a);
 
int main(int argc, char* argv[]) {
    int a, b;
    printf("argc = %d\n", argc);
 
    if(argc < 3) {
        a = 10;
        b = 30;
    } else {
        a = atoi(argv[1]);
        b = atoi(argv[2]);
    }
    printf("a = %d, b = %d\n", a, b);
    printf("a + b = %d\n", a + b);
 
    for(int i = 0; i < a; ++i) {
        printf("i = %d\n", i);
        // å‡½æ•°è°ƒç”¨
        int res = test(i);
        printf("res value: %d\n", res);
    }
 
    printf("THE END !!!\n");
    return 0;
}
int test(int a){
	int num = 0;
	for (int i = 0;i < a;++i){
		num += 1;
	}
    return num;
}



```

å¯¹ test.c è¿›è¡Œè°ƒè¯•å‰ç¼–è¯‘

```
gcc -g -Wall test.c -o test

```

æ³¨æ„ï¼š`-g` é€‰é¡¹çš„ä½œç”¨æ˜¯åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­åŠ å…¥æºä»£ç çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å¯æ‰§è¡Œæ–‡ä»¶ä¸­ç¬¬å‡ æ¡æœºå™¨æŒ‡ä»¤å¯¹åº”æºä»£ç çš„ç¬¬å‡ è¡Œï¼Œä½†å¹¶ä¸æ˜¯æŠŠæ•´ä¸ªæºæ–‡ä»¶åµŒå…¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥åœ¨è°ƒè¯•æ—¶å¿…é¡»ä¿è¯ gdb èƒ½æ‰¾åˆ°æºæ–‡ä»¶ã€‚

### GDB å¸¸ç”¨å‘½ä»¤åŠä½¿ç”¨

#### åŸºç¡€å‘½ä»¤

**å¯åŠ¨å‘½ä»¤**  
`gdb å¯æ‰§è¡Œç¨‹åº` ï¼šè¿›å…¥å¯æ‰§è¡Œç¨‹åºè°ƒè¯•æ–‡ä»¶

```
gdb test

```

![](https://img-blog.csdnimg.cn/c1a94c5972a447ee823087351300ee41.png)

**é€€å‡ºå‘½ä»¤**  
`quit` æˆ– `q` ï¼šé€€å‡ºè°ƒè¯•

```
quit
# q

```

![](https://img-blog.csdnimg.cn/22f66f2e7d2a40b19182e82dc08e8af7.png)

**å‚æ•°å‘½ä»¤**  
`set args å‚æ•°å€¼...`ï¼šç»™ç¨‹åºè®¾ç½®å‚æ•°  
`show args`ï¼šè·å–è®¾ç½®å‚æ•°

```
set args 10 20
show args

```

![](https://img-blog.csdnimg.cn/9bd0026e5c704ea3adbef428b26baa2e.png)

**å¸®åŠ©å‘½ä»¤**  
`help (å…·ä½“å‘½ä»¤)` ï¼šæŸ¥çœ‹è°ƒè¯•å¸®åŠ©æˆ–å…·ä½“æŒ‡ä»¤çš„ç›¸å…³æ–‡æ¡£

```
help
# help å…·ä½“å‘½ä»¤

```

![](https://img-blog.csdnimg.cn/6857e6928cb44e83bb30cf37397d5212.png)

**æŸ¥çœ‹æ–‡ä»¶ä»£ç å‘½ä»¤**  
**æŸ¥çœ‹å½“å‰æ–‡ä»¶**  
`list` æˆ– `l` ï¼šä»é»˜è®¤ä½ç½®æ˜¾ç¤º (é»˜è®¤æ˜¾ç¤º 10 è¡Œï¼Œä¸€ç›´ list ä¼šç»§ç»­ç”Ÿæˆ 10 è¡Œç›´åˆ°)  
`list è¡Œå·` æˆ– `l è¡Œå·` ï¼šä»æŒ‡å®šçš„è¡Œæ˜¾ç¤ºï¼ˆè¡Œå·ä¸ºä¸­é—´ä½ç½®ï¼Œä¸Šä¸‹ä¸€å¹¶æ˜¾ç¤ºï¼‰  
`list å‡½æ•°å` æˆ– `l å‡½æ•°å`ï¼šä»æŒ‡å®šçš„å‡½æ•°æ˜¾ç¤ºï¼ˆå‡½æ•°ååœ¨ä¸­é—´ï¼Œä¸Šä¸‹ä¸€å¹¶æ˜¾ç¤ºï¼‰

```
list
list 32
list test

```

![](https://img-blog.csdnimg.cn/84279a7973b34507b7ee23413f603083.png)  
**æŸ¥çœ‹éå½“å‰æ–‡ä»¶ä»£ç **  
`list æ–‡ä»¶å:è¡Œå·` æˆ– `l æ–‡ä»¶å:è¡Œå·` ï¼šä»æŒ‡å®šæ–‡ä»¶ä¸­æŒ‡å®šçš„è¡Œæ˜¾ç¤ºï¼ˆè¡Œå·ä¸ºä¸­é—´ä½ç½®ï¼Œä¸Šä¸‹ä¸€å¹¶æ˜¾ç¤ºï¼‰  
`list æ–‡ä»¶å:å‡½æ•°å` æˆ– `l æ–‡ä»¶å:å‡½æ•°å`ï¼šä»æŒ‡å®šæ–‡ä»¶ä¸­æŒ‡å®šçš„å‡½æ•°æ˜¾ç¤ºï¼ˆå‡½æ•°ååœ¨ä¸­é—´ï¼Œä¸Šä¸‹ä¸€å¹¶æ˜¾ç¤ºï¼‰  
æ³¨æ„ï¼šéå½“å‰æ–‡ä»¶ä¹Ÿæœ‰é™åˆ¶ï¼ˆéœ€åœ¨é“¾æ¥èŒƒå›´å†…å¦åˆ™ä¼šæŠ¥æ–‡ä»¶æ‰¾ä¸åˆ°çš„é”™è¯¯ï¼‰ï¼ŒæŸ¥çœ‹éå½“å‰æ–‡ä»¶ä»£ç æ—¶ä¹Ÿéœ€è¦ç”Ÿæˆ GDB è°ƒè¯•æ–‡ä»¶

```
g++ bubble.cpp main.cpp select.cpp -o main -g

```

```
list bubble.cpp:1
list select.cpp:selectSort

```

![](https://img-blog.csdnimg.cn/b6c83fb3ee754a2e8b184cc521336efd.png)![](https://img-blog.csdnimg.cn/f0644adda1574d56a542556f5d79708f.png)  
**è¡Œæ•°å‘½ä»¤**

`show listsize` æˆ– `show list` ï¼šè¾“å‡ºå½“å‰èƒ½ä¸€æ¬¡æ€§æ˜¾ç¤ºçš„ä»£ç è¡Œæ•°ï¼ˆä¸€èˆ¬é»˜è®¤æ˜¾ç¤ºè¡Œæ•°ä¸º 10 è¡Œï¼‰  
`set listsize è¡Œæ•°` æˆ– `set list è¡Œæ•°`ï¼šè®¾ç½®å½“å‰èƒ½ä¸€æ¬¡æ€§æ˜¾ç¤ºçš„ä»£ç è¡Œæ•°

```
show list
set list 20

```

![](https://img-blog.csdnimg.cn/9075cd676edf4fe1acca585b02ba0b21.png)

#### æ–­ç‚¹å‘½ä»¤

**è®¾ç½®æ–­ç‚¹**  
`break è¡Œå·` æˆ– `b è¡Œå·`  
`break å‡½æ•°å` æˆ– `b å‡½æ•°å`  
`break æ–‡ä»¶å:è¡Œå·` æˆ– `b æ–‡ä»¶å:è¡Œå·`  
`break æ–‡ä»¶å:å‡½æ•°` æˆ– `b æ–‡ä»¶å:å‡½æ•°`  
![](https://img-blog.csdnimg.cn/3bfc7498b00148dcad35356db9ab9599.png)

**æŸ¥çœ‹æ–­ç‚¹**  
`info break` æˆ– `i b`  
![](https://img-blog.csdnimg.cn/d454dc2d720f413fbbd1c1228c1ee1f6.png)

**åˆ é™¤æ–­ç‚¹**  
`delete æ–­ç‚¹ç¼–å·` æˆ– `del æ–­ç‚¹ç¼–å·` æˆ– `d æ–­ç‚¹ç¼–å·`  
![](https://img-blog.csdnimg.cn/9852063f28404be9946df3002df2c7f1.png)

**è®¾ç½®æ–­ç‚¹æ— æ•ˆ**  
`disable æ–­ç‚¹ç¼–å·` æˆ– `dis æ–­ç‚¹ç¼–å·`  
![](https://img-blog.csdnimg.cn/0b37e3e5998e4d5aaf8586b79258e176.png)

**è®¾ç½®æ–­ç‚¹ç”Ÿæ•ˆ**  
`enable æ–­ç‚¹ç¼–å·` æˆ– `ena æ–­ç‚¹ç¼–å·`  
![](https://img-blog.csdnimg.cn/8d681a3fc0c54dfd9f26764929c7670d.png)

**è®¾ç½®æ¡ä»¶æ–­ç‚¹**  
ä¸€èˆ¬ç”¨äºå¾ªç¯ä½“ï¼Œæ¡ä»¶ä¸­ç­‰å·åº”ä¸º `==` ã€‚  
`break æ–­ç‚¹ç¼–å· if æ¡ä»¶` æˆ– `b æ–­ç‚¹ç¼–å· if æ¡ä»¶`  
![](https://img-blog.csdnimg.cn/dcc52e8a2fb04ec696beeef78b2e5f27.png)

#### è°ƒè¯•å‘½ä»¤

**è¿è¡Œ GDB ç¨‹åº**  
ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤è¿è¡Œå‡å¯ï¼Œä¸ªäººä½¿ç”¨æ„Ÿè§‰æ²¡å•¥åŒºåˆ«  
`start`ï¼šè¿è¡Œç¨‹åºå¹¶åœæ­¢åœ¨ç¬¬ä¸€è¡Œ  
`run`ï¼šé‡åˆ°æ–­ç‚¹æ‰åœ  
![](https://img-blog.csdnimg.cn/916da5abc11d4f1291e8e69a34e3e336.png)

**ç»§ç»­è¿è¡Œå‘½ä»¤**  
`continue` æˆ– `c`ï¼šç»§ç»­è¿è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹åœ  
![](https://img-blog.csdnimg.cn/d1e681d39ebb409fb655c01ea29bb7cc.png)

**å‘ä¸‹æ‰§è¡Œå‘½ä»¤**  
`next` æˆ– `n`ï¼šå‘ä¸‹æ‰§è¡Œä¸€è¡Œä»£ç ï¼ˆä¸ä¼šè¿›å…¥å‡½æ•°ä½“ï¼‰  
![](https://img-blog.csdnimg.cn/cade7d8f428444a19b58209fae2a88bb.png)

**å˜é‡æ“ä½œå‘½ä»¤**  
`print å˜é‡å` æˆ– `p å˜é‡å`ï¼šæ‰“å°å˜é‡å€¼  
`ptype å˜é‡å`ï¼šæ‰“å°å˜é‡ç±»å‹  
![](https://img-blog.csdnimg.cn/5cd15667b57e45fe9bf14d7cbca72e88.png)

**å•æ­¥è°ƒè¯•å‘½ä»¤**  
`step` æˆ– `s`ï¼šå‘ä¸‹å•æ­¥è°ƒè¯•é‡åˆ°å‡½æ•°è¿›å…¥å‡½æ•°ä½“  
`finish`ï¼šè·³å‡ºå‡½æ•°ä½“  
![](https://img-blog.csdnimg.cn/47be96ce114342e5870266559d41ab9b.png)

#### å˜é‡è‡ªåŠ¨æ“ä½œ

`display å˜é‡å`ï¼šè‡ªåŠ¨æ‰“å°æŒ‡å®šå˜é‡çš„å€¼  
`info display` æˆ– `i display`ï¼šç»§ç»­è°ƒè¯•æ—¶å°±ä¼šè‡ªåŠ¨æ˜¾ç¤º display çš„å˜é‡  
`undisplay ç¼–å·`ï¼šä¸æ˜¾ç¤ºæ­¤ç¼–å·çš„ display å˜é‡  
![](https://img-blog.csdnimg.cn/658e5537411c4dacaefab26a14d38216.png)

**å…¶ä»–æ“ä½œ**  
`set var å˜é‡å = å˜é‡å€¼`ï¼šè®¾ç½®å˜é‡ï¼Œå¾ªç¯ä½“ç”¨å¾—å¤š  
`until`ï¼šè·³å‡ºå¾ªç¯  
![](https://img-blog.csdnimg.cn/924f1d8544ee44d8ab77636f0b88a74e.png)

æ ‡å‡† C åº“ IO å‡½æ•°å’Œ Linux ç³»ç»Ÿ IO å‡½æ•°å¯¹æ¯”
------------------------------

æ ‡å‡† C åº“çš„å‡½æ•°æ–‡æ¡£åœ¨ `man` çš„ç¬¬ä¸‰ç« ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼ˆä»¥`fopen`ä¸ºä¾‹ï¼‰

```
man 3 fopen

```

Linux ç³»ç»Ÿå‡½æ•°åœ¨ `man` çš„ç¬¬äºŒç« ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼ˆä»¥ open` ä¸ºä¾‹ï¼‰

```
man 2 open

```

### æ ‡å‡† C åº“ IO å‡½æ•°

![](https://img-blog.csdnimg.cn/5e592ad4163749849d9d1d5f45db4c3a.png)  
æ¯ä¸ªæ ‡å‡† C åº“çš„ IO å‡½æ•°éƒ½å¸¦æœ‰ç¼“å†²åŒºã€‚

### æ ‡å‡† C åº“ IO å‡½æ•°å’Œ Linux ç³»ç»Ÿ IO å‡½æ•°å·¥ä½œæµç¨‹

![](https://img-blog.csdnimg.cn/dfaf92454a164ccbbf337d1151686857.png)

### è¯¦ç»†å¯¹æ¯”

<table><thead><tr><th>ç‰¹æ€§</th><th>æ ‡å‡† C åº“ IO å‡½æ•°</th><th>Linux ç³»ç»Ÿ IO å‡½æ•°</th></tr></thead><tbody><tr><td>å¤´æ–‡ä»¶</td><td><code>&lt;stdio.h&gt;</code></td><td><code>&lt;unistd.h&gt;</code></td></tr><tr><td>ç¼“å†² IO</td><td>æœ‰ç¼“å†²</td><td>æ— ç¼“å†²</td></tr><tr><td>ç¼“å†²æ¨¡å¼</td><td>å¯è®¾ç½®ç¼“å†²æ¨¡å¼</td><td>æ— </td></tr><tr><td>æ–‡ä»¶æŒ‡é’ˆ</td><td><code>FILE*</code> ç±»å‹çš„æ–‡ä»¶æŒ‡é’ˆ</td><td>æ— </td></tr><tr><td>é˜»å¡ IO</td><td>é˜»å¡</td><td>é˜»å¡æˆ–éé˜»å¡</td></tr><tr><td>æ–‡ä»¶æè¿°ç¬¦</td><td>é€šè¿‡ <code>fileno()</code> å‡½æ•°è·å–</td><td>ç›´æ¥ä½¿ç”¨æ•´æ•°ç±»å‹çš„æ–‡ä»¶æè¿°ç¬¦</td></tr><tr><td>é€‚ç”¨èŒƒå›´</td><td>æ–‡ä»¶ã€æ–‡æœ¬</td><td>æ–‡ä»¶ã€æ–‡æœ¬ã€ç®¡é“ã€å¥—æ¥å­—</td></tr><tr><td>æ•°æ®æ ¼å¼</td><td>æ ¼å¼åŒ–è¾“å…¥è¾“å‡º</td><td>æ— </td></tr><tr><td>å¹¶å‘å’Œå¼‚æ­¥æ”¯æŒ</td><td>æœ‰é™</td><td>æ”¯æŒéé˜»å¡ IOã€å¼‚æ­¥ IO</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>é€šå¸¸ç”¨äºå¸¸è§„ IO æ“ä½œ</td><td>æ›´åº•å±‚ã€é«˜æ€§èƒ½ã€ç½‘ç»œç¼–ç¨‹</td></tr></tbody></table>

è™šæ‹Ÿåœ°å€ç©ºé—´
------

> æ­¤å†…å­˜ç©ºé—´æ˜¯ä¸å­˜åœ¨çš„æ˜¯ç”¨æ¥æ–¹ä¾¿è§£é‡Šä»£ç çš„æ‰§è¡Œé€»è¾‘ï¼Œåœ¨å†…æ ¸é€šè¿‡é€»è¾‘ç®¡ç†å•å…ƒ mmu æ˜ å°„åˆ°ç‰©ç†å†…å­˜ã€‚

![](https://img-blog.csdnimg.cn/c62dd0c10d5248d0ae5e3e28814ae655.png)

æ–‡ä»¶æè¿°ç¬¦
-----

> æ–‡ä»¶æè¿°ç¬¦è¡¨æœ¬è´¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå‰ä¸‰ä¸ªæ•°å­— 0ã€1ã€2 å›ºå®šåé¢å¯çœ‹ä½œä¸ºæ–‡ä»¶ç¼–å·æ–¹ä¾¿æ‰“å¼€æ–‡ä»¶ï¼Œé»˜è®¤å¤§å°ä¸º 1024byteã€‚

![](https://img-blog.csdnimg.cn/7ef031d176d54038854da03637c537af.png)  
æ³¨æ„ï¼šä¸€ä¸ªæ–‡ä»¶å¯ä»¥æ‰“å¼€å¤šæ¬¡ï¼Œä½†æ˜¯æ¯æ¬¡æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ä¸åŒã€‚**åé¢ä»‹ç»çš„å‡½æ•°å‡ä¸º Linux ç³»ç»Ÿ IO å‡½æ•°**ã€‚

openã€close å‡½æ•°
-------------

**`int open(const char *pathname, int flags);`**

*   **ä½œç”¨**ï¼šæ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶
*   **å‚æ•°**ï¼š
    *   `pathname`ï¼šè¦æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„
    *   `flags`ï¼šå¯¹æ–‡ä»¶æ“ä½œçš„æƒé™è®¾ç½®ï¼ˆè¿˜æœ‰å…¶ä»–è®¾ç½®ï¼‰
        *   **å¿…é€‰é¡¹**ï¼š`O_RDONLY` åªè¯»ï¼Œ `O_WRONLY` åªå†™ï¼Œ `O_RDWR` è¯»å†™
        *   **å¯é€‰é¡¹**ï¼š`O_CREAT` æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å›ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼›å¦‚æœå¤±è´¥è¿”å› - 1

**`void perror(const char *s);`**

*   **ä½œç”¨**ï¼šæ‰“å° errno å¯¹åº”çš„é”™è¯¯æè¿°
*   **å‚æ•°**ï¼š`s`ï¼šç”¨æˆ·æè¿°ï¼Œæ¯”å¦‚ helloï¼Œæœ€ç»ˆè¾“å‡ºçš„å†…å®¹æ˜¯ hello:xxx(å®é™…çš„é”™è¯¯æè¿°ï¼‰
*   **è¿”å›å€¼**ï¼šerrno å±äº Linux ç³»ç»Ÿå‡½æ•°åº“ï¼Œåº“é‡Œé¢çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè®°å½•çš„æ˜¯æœ€è¿‘çš„é”™è¯¯å·ï¼Œè¿”å›å¯¹åº”çš„ errno é”™è¯¯æè¿°

**ä»£ç ç¤ºä¾‹**

```
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdio.h>
#include <unistd.h>

int main(){
    int fd = open("a.txt",O_RDONLY);
    if(fd == -1){
    	//å‚æ•°ä¸€èˆ¬ä¸ºè°ƒç”¨å‡½æ•°
        perror("open");
    }
    //å…³é—­
    close(fd);
    return 0;
}

```

![](https://img-blog.csdnimg.cn/9c77c2a6cc2547f18f2bd3651c7c6226.png)

**`int open(const char *pathname,int flags, mode_t mode);`**

*   **ä½œç”¨**ï¼šæ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶
*   **å‚æ•°**ï¼š
    *   `pathname`ï¼šè¦æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„
    *   `flags`ï¼šå¯¹æ–‡ä»¶æ“ä½œçš„æƒé™è®¾ç½®ï¼ˆè¿˜æœ‰å…¶ä»–è®¾ç½®ï¼‰
        *   **å¿…é€‰é¡¹**ï¼š`O_RDONLY` åªè¯»ï¼Œ `O_WRONLY` åªå†™ï¼Œ `O_RDWR` è¯»å†™
        *   **å¯é€‰é¡¹**ï¼š`O_CREAT` æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶
    *   `mode`ï¼šå…«è¿›åˆ¶çš„æ•°ï¼Œè¡¨ç¤ºåˆ›å»ºå‡ºçš„æ–°çš„æ–‡ä»¶çš„æ“ä½œæƒé™ï¼Œæœ€ç»ˆæƒé™ä¸º `mode & ~umask`  
        ï¼Œ`umask` çš„ä½œç”¨å°±æ˜¯æŠ¹å»æŸäº›æƒé™ï¼Œè°ƒç”¨`umask` å‡½æ•°å¯è®¾å®š
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å›ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœå¤±è´¥è¿”å› - 1

**ä»£ç ç¤ºä¾‹**

```
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdio.h>
#include <unistd.h>

int main(){
	//åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶
	//flagså‚æ•°æ˜¯ä¸€ä¸ªintç±»å‹çš„æ•°æ®ï¼Œå 4ä¸ªå­—èŠ‚ï¼Œ32ä½flags 32ä¸ªä½ï¼Œæ¯ä¸€ä½å°±æ˜¯ä¸€ä¸ªæ ‡å¿—ä½ã€‚
	//ä½¿ç”¨æŒ‰ä½æˆ–ï¼š| åŸå› æ˜¯æ¯ä¸ªflagéƒ½æ˜¯äº’æ–¥çš„ï¼Œåªèƒ½é€šè¿‡æˆ–æ¥è¿›è¡Œæƒé™çš„å¢æ·»ã€‚
    int fd = open("a.txt", O_RDONLY | O_CREAT, 0777);
    if(fd == -1){
    	//å‚æ•°ä¸€èˆ¬ä¸ºè°ƒç”¨å‡½æ•°
        perror("open");
    }
    //å…³é—­
    close(fd);
    return 0;
}

```

![](https://img-blog.csdnimg.cn/2f4a9adb0c5d47a3944d722931ee5572.png)

**`int close(int fd);`**

*   **ä½œç”¨**ï¼šå…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼ˆå…»æˆæ¯æ‰“å¼€ä¸€æ¬¡æ–‡ä»¶åŒ¹é…ä¸€ä¸ªæ­¤å‡½æ•°çš„ä¹ æƒ¯ï¼‰
*   **å‚æ•°**ï¼š`fd`ï¼šæ–‡ä»¶æè¿°ç¬¦
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å› 0ï¼Œå¦‚æœå¤±è´¥è¿”å› - 1

readã€write å‡½æ•°
-------------

> ä¸¤è€…æ­é…ä¸€èˆ¬ç”¨äºæ‹·è´æ–‡ä»¶å†…å®¹

**`ssize_t read(int fd, void *buf, size_t count);`**

*   **ä½œç”¨**ï¼šè¯»å–æŒ‡å®šæ–‡ä»¶
*   **å‚æ•°**ï¼š
    *   `fd`ï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œopen å¾—åˆ°çš„ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æ“ä½œæŸä¸ªæ–‡ä»¶
    *   `buf`ï¼šéœ€è¦è¯»å–æ•°æ®å­˜æ”¾çš„åœ°æ–¹ï¼Œæ•°ç»„çš„åœ°å€ï¼ˆä¼ å‡ºå‚æ•°)
    *   `count`ï¼šè¦è¯»çš„æ•°æ®çš„å®é™…çš„å¤§å°
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸå¤§äº 0 è¿”å›å®é™…è¯»å–åˆ°çš„å­—èŠ‚æ•°ï¼Œç­‰äº 0 è¡¨ç¤ºæ–‡ä»¶å·²ç»è¯»å–å®Œæ¯•ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

**`ssize_t write(int fd, const void *buf, size_t count);`**

*   **ä½œç”¨**ï¼šå†™å…¥æŒ‡å®šæ–‡ä»¶
*   **å‚æ•°**ï¼š
    *   `fd`ï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œopen å¾—åˆ°çš„ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æ“ä½œæŸä¸ªæ–‡ä»¶
    *   `buf`ï¼šè¦å¾€ç£ç›˜å†™å…¥çš„æ•°æ®ï¼Œæ•°ç»„çš„åœ°å€ï¼ˆä¼ å…¥å‚æ•°)
    *   `count`ï¼šè¦å†™çš„æ•°æ®çš„å®é™…çš„å¤§å°
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸå¤§äº 0 è¿”å›å®é™…è¯»å–åˆ°çš„å­—èŠ‚æ•°ï¼Œç­‰äº 0 è¡¨ç¤ºæ²¡æœ‰ä»»ä½•å†…å®¹å†™å…¥æ–‡ä»¶ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

```
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdio.h>
#include <unistd.h>

int main(){
    //1. é€šè¿‡ open æ‰“å¼€ source.txt æ–‡ä»¶
    int source_fd = open("source.txt", O_RDONLY);
    if(source_fd == -1){
        perror("open");
        return -1;
    }

    //2. åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼ˆæ‹·è´æ–‡ä»¶ï¼‰
    int copy_fd = open("copy.txt", O_WRONLY | O_CREAT, 0777);
    if(copy_fd == -1){
        perror("open");
        return -1;
    }

    //3. é¢‘ç¹çš„è¯»å†™æ“ä½œï¼Œæ³¨æ„bufæ˜¯ä¸€ä¸ªæ•°ç»„éœ€å…ˆåˆ†é…å’Œåˆå§‹åŒ–ï¼Œå¾ªç¯æ¡ä»¶æ³¨æ„>ä¼˜å…ˆçº§å¤§äº=éœ€è¦å·¦è¾¹è¡¨è¾¾å¼åŠ ä¸Šæ‹¬å·
    char buf[1024]={0};
    int len = 0;
    while((len = read(source_fd, buf, sizeof(buf)))>0){
        write(copy_fd, buf, len); 
    }
    //4. å…³é—­æ–‡ä»¶
    close(source_fd);
    close(copy_fd);

    return 0;
}

```

lseek å‡½æ•°
--------

**`off_t lseek(int fd, off_t offset, int whence);`**

*   **ä½œç”¨**ï¼š1. ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåˆ°æ–‡ä»¶å¤´`lseek(fd,0ï¼ŒSEEK_SET);`  
    Â Â Â Â Â Â Â Â Â Â Â 2. è·å–å½“å‰æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®`lseek(fdï¼Œ0ï¼ŒSEEK_CUR);`  
    Â Â Â Â Â Â Â Â Â Â Â 3. è·å–æ–‡ä»¶é•¿åº¦`lseek(fd,0ï¼ŒSEEK_END);`  
    Â Â Â Â Â Â Â Â Â Â Â 4. æ‹“å±•æ–‡ä»¶çš„é•¿åº¦ï¼ˆå¦‚ï¼šå½“å‰æ–‡ä»¶ 10bï¼Œ110bï¼Œå¢åŠ äº† 100 ä¸ªå­—èŠ‚ï¼‰`lseek(fd,100,SEEK_END);`
    
*   **å‚æ•°**ï¼š
    
    *   `fd`ï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œopen å¾—åˆ°çš„ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æ“ä½œæŸä¸ªæ–‡ä»¶
    *   `offset`ï¼šåç§»é‡
    *   `whence`ï¼š
        *   `SEEK SET` è®¾ç½®æ–‡ä»¶æŒ‡é’ˆçš„åç§»é‡
        *   `SEEK CUR` è®¾ç½®åç§»é‡ï¼šå½“å‰ä½ç½® + ç¬¬äºŒä¸ªå‚æ•° offset çš„å€¼
        *   `SEEK END` è®¾ç½®åç§»é‡ï¼šæ–‡ä»¶å¤§å° + ç¬¬äºŒä¸ªå‚æ•° offset çš„å€¼
*   **è¿”å›å€¼**ï¼šè¿”å›æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®
    

**ä»£ç ç¤ºä¾‹**

```
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdio.h>
#include <unistd.h>

int main()
{
    int fd = open("hello.text", O_RDWR);
    if (fd == -1)
    {
        perror("open");
        return -1;
    }

    // æ‰©å±•æ–‡ä»¶çš„é•¿åº¦
    lseek(fd, 100, SEEK_END);

    // ä¸ºæ–¹ä¾¿æ˜¾ç¤ºå½•å…¥æ•°æ®åçš„å˜åŒ–ï¼Œå†™å…¥ç©ºå­—ç¬¦å¡«æ»¡å¹¶å¢åŠ 1å­—èŠ‚
    write(fd, " ", 1);
    
    // å…³é—­æ–‡ä»¶
    close(fd);
    return 0;
}

```

**ä»£ç æ‰§è¡Œå‰**  
![](https://img-blog.csdnimg.cn/3e03bc0f22bf4a08bc7db8574c4f5aac.png)

**ä»£ç æ‰§è¡Œå**  
![](https://img-blog.csdnimg.cn/e60ce0577693498184ef755bcbab10c5.png)  
æ³¨æ„ï¼š`lseek` æ‹“å±•æ–‡ä»¶ç›¸å½“äºï¼š**å…ˆå å‘ï¼Œå†æ‹‰ğŸ’©**ï¼Œå…å¾—æ­£è„±è£¤å­çš„æ—¶å€™åˆ«äººæŠŠä½ å‘å äº†ç›´æ¥æ‹‰ã€‚

statã€lstat å‡½æ•°
-------------

**`int stat(const char *pathname, struct stat statbuf);`**

*   **ä½œç”¨**ï¼šè·å–ä¸€ä¸ªæ–‡ä»¶ç›¸å…³çš„ä¸€äº›ä¿¡æ¯
*   **å‚æ•°**ï¼š
    *   `pathname`ï¼šæ“ä½œçš„æ–‡ä»¶çš„è·¯å¾„
    *   `statbuf`ï¼šç»“æ„ä½“å˜é‡ï¼Œä¼ å‡ºå‚æ•°ï¼Œç”¨äºä¿å­˜è·å–åˆ°çš„æ–‡ä»¶çš„ä¿¡æ¯
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å› 0ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

**ä»£ç ç¤ºä¾‹**

```
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdio.h>
#include <unistd.h>

int main(){

    struct stat statbuf;
    int ret = stat("hello.txt", &statbuf);
    if (ret == -1)
    {
        perror("stat");
        return -1;
    }
    printf( "size: %ld\n", statbuf.st_size);


    return 0;
}

```

![](https://img-blog.csdnimg.cn/8d28d7171c7e48f1ae919c645d825071.png)

![](https://img-blog.csdnimg.cn/ad502c50fdba4f50824379e68a7945b3.png)

**`int lstat(const char *pathname,struct stat statbuf);`**

*   **ä½œç”¨**ï¼šè·å–ä¸€ä¸ªè½¯é“¾æ¥æ–‡ä»¶æŒ‡å‘çš„æ–‡ä»¶çš„ç›¸å…³çš„ä¸€äº›ä¿¡æ¯
*   **å‚æ•°**ï¼š
    *   `pathname`ï¼šæ“ä½œçš„æ–‡ä»¶çš„è·¯å¾„
    *   `statbuf`ï¼šç»“æ„ä½“å˜é‡ï¼Œä¼ å‡ºå‚æ•°ï¼Œç”¨äºä¿å­˜è·å–åˆ°çš„æ–‡ä»¶çš„ä¿¡æ¯
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å› 0ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

### stat ç»“æ„ä½“

```
struct stat
{
    dev_t      st _dev; // æ–‡ä»¶çš„è®¾å¤‡ç¼–å·
    ino_t      st_ino; // èŠ‚ç‚¹
    mode_t     st_mode; // æ–‡ä»¶çš„ç±»å‹å’Œå­˜å–çš„æƒé™
    nlink_t    st_nlink; // è¿åˆ°è¯¥æ–‡ä»¶çš„ç¡¬è¿æ¥æ•°ç›®
    uid_t      st_uid; // ç”¨æˆ·ID
    gid_t      st_gid; // ç»„ID
    dev_t      st_rdev; // è®¾å¤‡æ–‡ä»¶çš„è®¾å¤‡ç¼–å·
    off_t      st_size; // æ–‡ä»¶å­—èŠ‚æ•°(æ–‡ä»¶å¤§å°)
    blksize_t  st_blksize; // å—å¤§å°
    blkcnt_t   st_blocks; // å—æ•°
    time_t     st_atime; // æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´
    time_t     st_mtime; // æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´(æŒ‡å†…å®¹)
    time_t     st_ctime; // æœ€åä¸€æ¬¡æ”¹å˜æ—¶é—´(æŒ‡å±æ€§)
};

```

### st_mode å˜é‡

![](https://img-blog.csdnimg.cn/9735ca5b95644c92a9885f599b23953a.png)

### è½¯é“¾æ¥ä¸ç¡¬é“¾æ¥

> **è½¯é“¾æ¥æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œå®ƒåŒ…å«æŒ‡å‘ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚** è½¯é“¾æ¥é€šå¸¸ç”¨äºè·¨æ–‡ä»¶ç³»ç»Ÿçš„é“¾æ¥æˆ–è€…éœ€è¦åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä¿ç•™ä¸€äº›ç‰¹æ®Šç»“æ„çš„æƒ…å†µã€‚  
> **ç¡¬é“¾æ¥æ˜¯åœ¨åŒä¸€æ–‡ä»¶ç³»ç»Ÿä¸Šçš„åŒä¸€æ–‡ä»¶æˆ–ç›®å½•çš„å¤šä¸ªåç§°ã€‚** ç¡¬é“¾æ¥é€šå¸¸ç”¨äºåœ¨åŒä¸€æ–‡ä»¶ç³»ç»Ÿå†…å…±äº«æ–‡ä»¶å†…å®¹è€Œä¸å ç”¨é¢å¤–ç©ºé—´çš„æƒ…å†µã€‚

ä¸‹é¢æ˜¯å…³äºè½¯é“¾æ¥å’Œç¡¬é“¾æ¥çš„åŒºåˆ«çš„è¡¨æ ¼æ€»ç»“ï¼š

<table><thead><tr><th>ç‰¹æ€§</th><th>è½¯é“¾æ¥<br>ï¼ˆSymbolic Linkï¼‰</th><th>ç¡¬é“¾æ¥<br>ï¼ˆHard Linkï¼‰</th></tr></thead><tbody><tr><td>æ–‡ä»¶ç±»å‹</td><td>æ–‡ä»¶å’Œç›®å½•</td><td>ä»…é™æ–‡ä»¶</td></tr><tr><td>è·¨æ–‡ä»¶ç³»ç»Ÿ</td><td>å¯ä»¥</td><td>ä¸å¯ä»¥</td></tr><tr><td>å­˜åœ¨ç›®æ ‡åˆ é™¤å</td><td>æ˜¯ï¼Œä½†æŒ‡å‘ â€œæ­»é“¾æ¥â€</td><td>å¦</td></tr><tr><td>å ç”¨é¢å¤–ç£ç›˜ç©ºé—´</td><td>æ˜¯</td><td>å¦</td></tr><tr><td>å…±äº« inode</td><td>å¦</td><td>æ˜¯</td></tr><tr><td>é€‚ç”¨æ€§</td><td>è·¨æ–‡ä»¶ç³»ç»Ÿã€ç›®å½•ã€æ–‡ä»¶</td><td>ä»…é™åŒä¸€æ–‡ä»¶ç³»ç»Ÿå†…çš„æ–‡ä»¶</td></tr></tbody></table>

### è½¯é“¾æ¥æ–‡ä»¶çš„åˆ›å»º

**ä»£ç ç¤ºä¾‹**

```
ln -s a.txt b.txt

```

**æ‰§è¡Œä»£ç **  
![](https://img-blog.csdnimg.cn/fd63f109f3c543fe9743bcd137c8b849.png)  
**ç”Ÿæˆè½¯é“¾æ¥**  
![](https://img-blog.csdnimg.cn/41aa7220e6b646299dfa6da49538f284.png)

**åˆ é™¤è½¯é“¾æ¥**  
å¦‚æœåˆ é™¤ a.txt æ–‡ä»¶ä¼šæˆä¸º â€œæ­»é“¾æ¥â€ï¼Œæ— æ³•æ‰“å¼€ b.txt æ–‡ä»¶  
![](https://img-blog.csdnimg.cn/87701d8ec14c4b77a7d1841585445a53.png)  
æ³¨æ„ï¼šå½“åˆ›å»ºè½¯é“¾æ¥åä½¿ç”¨ vim æŸ¥çœ‹ b.txt æ–‡ä»¶æ—¶ä¼šè¿›å…¥ a.txt æ–‡ä»¶ï¼Œå¯¹ b.txt ä½¿ç”¨`stat` å‡½æ•°ä¼šè·å–åˆ° a.txt æ–‡ä»¶ä¿¡æ¯ï¼Œè¦è·å–è½¯é“¾æ¥æ–‡ä»¶ b.txt ä¿¡æ¯åº”è¯¥ä½¿ç”¨ `lstat` å‡½æ•°ã€‚

### æ¨¡æ‹Ÿå®ç° ls -l å‘½ä»¤

`ls -l æ–‡ä»¶å` ï¼šç”¨äºåˆ—å‡ºæ–‡ä»¶å’Œç›®å½•è¯¦ç»†ä¿¡æ¯çš„å‘½ä»¤ï¼ŒåŒ…æ‹¬æ–‡ä»¶çš„æƒé™ã€æ‰€æœ‰è€…ã€å¤§å°ã€åˆ›å»ºæ—¥æœŸç­‰ã€‚

![](https://img-blog.csdnimg.cn/800efc65317e485cb9bc6176aa602b71.png)

```
//æ¨¡æ‹Ÿå®ç° ls -l å‘½ä»¤
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdio.h>
#include <unistd.h>
#include <pwd.h>
#include <grp.h>
#include <time.h>
#include <string.h>


int main(int argc, char* argv[]){

    //åˆ¤æ–­è¾“å…¥çš„å‚æ•°æ˜¯å¦æ­£ç¡®ï¼Œä¸æ­£ç¡®åˆ™æç¤º
    if (argc>2)
    {
        printf("%s filename\n",argv[0]);
        //exit();
        return -1;
    }

    //é€šè¿‡statå‡½æ•°è·å–ç”¨æˆ·ä¼ å…¥çš„æ–‡ä»¶ä¿¡æ¯
    struct stat st;
    int ret = stat(argv[1],&st);
    if (ret == -1)
    {
        perror("stat");
        return -1;
    }

    // è·å–æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶æƒé™
    char perms[11] = {0}; // ç”¨äºä¿å­˜æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶æƒé™çš„å­—ç¬¦ä¸²
    switch (st.st_mode & __S_IFMT)
    {
    case __S_IFLNK:
        perms[0] = 'l';
        break;
    case __S_IFDIR:
        perms[0] = 'd';
        break;
    case __S_IFREG:
        perms[0] = '-';
        break;
    case __S_IFBLK:
        perms[0] = 'b';
        break;
    case __S_IFCHR:
        perms[0] = 'c';
        break;
    case __S_IFSOCK:
        perms[0] = 's';
        break;
    case __S_IFIFO:
        perms[0] = 'p';
        break;
    default:
        perms[0] = '?';
        break;
    }

    //åˆ¤æ–­æ–‡ä»¶çš„è®¿é—®æƒé™

    //æ–‡ä»¶æ‰€æœ‰è€…è®¿é—®æƒé™
    perms[1] = (st.st_mode & S_IRUSR)? 'r' : '-' ;
    perms[2] = (st.st_mode & S_IWUSR)? 'w' : '-' ;
    perms[3] = (st.st_mode & S_IXUSR)? 'x' : '-' ;
    
    //æ–‡ä»¶æ‰€åœ¨ç»„è®¿é—®æƒé™
    perms[4] = (st.st_mode & S_IRGRP)? 'r' : '-' ;
    perms[5] = (st.st_mode & S_IWGRP)? 'w' : '-' ;
    perms[6] = (st.st_mode & S_IXGRP)? 'x' : '-' ;
    
    //å…¶ä»–äººè®¿é—®æƒé™
    perms[7] = (st.st_mode & S_IROTH)? 'r' : '-' ;
    perms[8] = (st.st_mode & S_IWOTH)? 'w' : '-' ;
    perms[9] = (st.st_mode & S_IXOTH)? 'x' : '-' ;
    
    //ç¡¬é“¾æ¥æ•°
    int linkNum = st.st_nlink;

    //æ–‡ä»¶æ‰€æœ‰è€…åç§°
    char* fileUsr = getpwuid(st.st_uid)->pw_name;

    //æ–‡ä»¶æ‰€åœ¨ç»„åç§°
    char* fileGrp = getgrgid(st.st_gid)->gr_name;
    
    //æ–‡ä»¶å¤§å°
    off_t fileSize = st.st_size;
    
    //è·å–ä¿®æ”¹æ—¶é—´
    char* time = ctime(&st.st_mtime);
    
    //åˆ é™¤timeå¸¦æ¥çš„æ¢è¡Œ
    char mtime[512];
    strncpy(mtime, time, strlen(time)-1);

    //è¾“å‡º
    char buf[1024];
    sprintf(buf,"%s %d %s %s %ld %s %s", perms, linkNum, fileUsr, fileGrp, fileSize, mtime, argv[1]);

    printf("%s\n", buf);

    return 0;
}


```

![](https://img-blog.csdnimg.cn/95359cf2c2c04064ac06590d98551022.png)  
æ³¨æ„ï¼šæ­¤ä»£ç å·©å›ºäº† st_mode ç¼–ç çš„è¿ç”¨ï¼Œå¤šå¤šå“å‘³ä¸€äº›ç»†èŠ‚ã€‚`off_t` è¡¨ç¤º `long int` ã€‚

æ–‡ä»¶å±æ€§æ“ä½œå‡½æ•°
--------

### access å‡½æ•°

**`int access(const char *pathname, int mode);`**

*   **ä½œç”¨**ï¼šåˆ¤æ–­æŸä¸ªæ–‡ä»¶æ˜¯å¦æœ‰æŸä¸ªæƒé™ï¼Œæˆ–è€…åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨å‚æ•°
*   **å‚æ•°**ï¼š
    *   `pathname`ï¼šåˆ¤æ–­çš„æ–‡ä»¶è·¯å¾„
    *   `mode`ï¼š`R_OK`åˆ¤æ–­æ˜¯å¦æœ‰è¯»æƒé™ï¼Œ`w_OK`åˆ¤æ–­æ˜¯å¦æœ‰å†™æƒé™ï¼Œ`X_OK`åˆ¤æ–­æ˜¯å¦æœ‰æ‰§è¡Œæƒé™ï¼Œ`F_OK`åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å› 0ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

**ä»£ç ç¤ºä¾‹**

```
#include <unistd.h>
#include <stdio.h>

int main(){
    int ret = access("c.txt", F_OK);
    if (ret == -1)
    {
        perror("access");
    }
    printf("æ–‡ä»¶ä¸å­˜åœ¨ï¼\n");
    return 0;
}

```

![](https://img-blog.csdnimg.cn/f90c0c66a2ea4357bebfe8883ed6e495.png)

### chomd å‡½æ•°

**`int chmod(const char *pathname, mode_t mode);`**

*   **ä½œç”¨**ï¼šä¿®æ”¹æ–‡ä»¶çš„æƒé™
*   **å‚æ•°**ï¼š
    *   `pathname`ï¼šéœ€è¦ä¿®æ”¹çš„æ–‡ä»¶çš„è·¯å¾„
    *   `mode`ï¼šéœ€è¦ä¿®æ”¹çš„æƒé™å€¼ï¼Œå…«è¿›åˆ¶çš„æ•°
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å› 0ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

**ä»£ç ç¤ºä¾‹**

```
#include <sys/stat.h>
#include <stdio.h>

int main(){
    int ret = chmod("a.txt",0777);
    if (ret == -1){
        perror("chmod");
        return -1;
    }
    return 0;
}

```

**ä»£ç æ‰§è¡Œå‰**  
![](https://img-blog.csdnimg.cn/89b995e3ff5546ef986eaa25aae2bdfb.png)  
**ä»£ç æ‰§è¡Œå**  
![](https://img-blog.csdnimg.cn/0adf6ff2b7fb4e05988634402ff11ec9.png)

### chown å‡½æ•°

**`int chown (const char *pathname, uid_t owner, gid_t group);`**

*   **ä½œç”¨**ï¼šä¿®æ”¹æ–‡ä»¶çš„æ‰€æœ‰è€…ä¸æ‰€æœ‰ç»„
*   **å‚æ•°**ï¼š
    *   `pathname`ï¼šéœ€è¦ä¿®æ”¹çš„æ–‡ä»¶çš„è·¯å¾„
    *   `owner`ï¼šæ‰€æœ‰è€…çš„ ID
    *   `group`ï¼šæ‰€æœ‰ç»„çš„ ID
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å› 0ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

**æ‰€æœ‰è€… ID æŸ¥çœ‹**

```
vim /etc/passwd

```

**æ‰€æœ‰ç»„ ID æŸ¥çœ‹**

```
vim /etc/group

```

### truncate å‡½æ•°

**`int truncate(const char *path, off_t length);`**

*   **ä½œç”¨**ï¼šç¼©å‡æˆ–è€…æ‰©å±•æ–‡ä»¶çš„å°ºå¯¸è‡³æŒ‡å®šçš„å¤§å°
*   **å‚æ•°**ï¼š
    *   `path`ï¼šéœ€è¦ä¿®æ”¹çš„æ–‡ä»¶çš„è·¯å¾„
    *   `length`ï¼šéœ€è¦æœ€ç»ˆæ–‡ä»¶å˜æˆçš„å¤§å°
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å› 0ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

**ä»£ç ç¤ºä¾‹**

```
#include <unistd.h>
#include <sys/types.h>
#include <stdio.h>

int main(){
    int ret = truncate("b.txt", 20);
    if (ret == -1)
    {
        perror("truncate");
        return -1;
    }
    return 0;
}

```

æ³¨æ„ï¼š`truncate` å‡½æ•°å¯ä»¥é€šè¿‡æ”¹å˜æ–‡ä»¶çš„å¤§å°æ¥åˆ é™¤æˆ–æ·»åŠ æ–‡ä»¶å†…å®¹ï¼Œè€Œ `lseek` å‡½æ•°åªæ˜¯ç”¨äºç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®ã€‚

ç›®å½•æ“ä½œå‡½æ•°
------

### mkdir å‡½æ•°

**`int mkdir(const char *pathname, mode_t mode);`**

*   **ä½œç”¨**ï¼šåˆ›å»ºä¸€ä¸ªç›®å½•
*   **å‚æ•°**ï¼š
    *   `pathname`ï¼šåˆ›å»ºçš„ç›®å½•çš„è·¯å¾„
    *   `mode`ï¼šæƒé™ï¼Œå…«è¿›åˆ¶çš„æ•°
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å› 0ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

**ä»£ç ç¤ºä¾‹**

```
#include <sys/stat.h>
#include <sys/types.h>
#include <stdio.h>
int main()
{
    int ret = mkdir("aaa", 0777);
    if (ret == -1)
    {
        perror("mkdir");
        return -1;
    }
    return 0;
}

```

### rmdir å‡½æ•°

**`int rmdir (const char *pathname);`**

*   **ä½œç”¨**ï¼šåˆ é™¤ä¸€ä¸ªç©ºç›®å½•ï¼ˆåªèƒ½æ˜¯ç©ºç›®å½•å«æ–‡ä»¶ä¼šæŠ¥é”™ï¼‰
*   **å‚æ•°**ï¼š`pathname`ï¼šéœ€åˆ é™¤çš„ç›®å½•çš„è·¯å¾„
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å› 0ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

### rename å‡½æ•°

**`int rename(const char *oldpath,const char *newpath);`**

*   **ä½œç”¨**ï¼šåˆ›å»ºä¸€ä¸ªç›®å½•
*   **å‚æ•°**ï¼š
    *   `oldpath`ï¼šå½“å‰ç›®å½•çš„è·¯å¾„å
    *   `newpath`ï¼šæ”¹åç›®å½•çš„è·¯å¾„å
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å› 0ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

**ä»£ç ç¤ºä¾‹**

```
#include <stdio.h>
int main()
{
    int ret = rename("aaa", "bbb");
    if (ret == -1)
    {
        perror("rename");
        return -1;
    }
    return 0;
}

```

### chdir å‡½æ•°

**`int chdir(const char *path);`**

*   **ä½œç”¨**ï¼šä¿®æ”¹è¿›ç¨‹çš„å·¥ä½œç›®å½•
*   **å‚æ•°**ï¼š`path`ï¼šéœ€ä¿®æ”¹çš„å·¥ä½œç›®å½•çš„è·¯å¾„
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å› 0ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

### getcwd å‡½æ•°

**`char *getcwd(char *buf, size_t size);`**

*   **ä½œç”¨**ï¼šè·å–å½“å‰çš„å·¥ä½œç›®å½•
*   **å‚æ•°**ï¼š
    *   `buf`ï¼šå­˜å‚¨çš„è·¯å¾„ï¼ŒæŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ•°ç»„
    *   `size`ï¼šæ•°ç»„çš„å¤§å°
*   **è¿”å›å€¼**ï¼šè¿”å›æŒ‡å‘çš„ä¸€å—å†…å­˜ï¼Œè¿™å—å†…å­˜çš„æ•°æ®å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°

**ä»£ç ç¤ºä¾‹**

```
#include <unistd.h>
#include <stdio.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <fcntl.h>
int main(){
    // è·å–å½“å‰çš„å·¥ä½œç›®å½•
    char buf[128];
    getcwd(buf, sizeof(buf));
    printf("å½“å‰çš„å·¥ä½œç›®å½•æ˜¯:%s\n", buf);

    // ä¿®æ”¹å·¥ä½œç›®å½•
    int ret = chdir("/home/zxz/open_file_excise/change_direction");
    if (ret == -1)
    {
        perror("chdir");
        return -1;
    }

    // åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶
    int fd = open("chdir.txt", O_CREAT | O_RDWR, 0664);
    if (fd == -1)
    {
        perror("open");
        return -1;
    }
    close(fd);

    // è·å–ä¿®æ”¹åå½“å‰çš„å·¥ä½œç›®å½•
    char buf1[128];
    getcwd(buf1, sizeof(buf1));
    printf("å½“å‰çš„å·¥ä½œç›®å½•æ˜¯:%s\n", buf1);
    return 0;
}

```

![](https://img-blog.csdnimg.cn/ccb088fb70704909bc20bb964aaa55b3.png)

ç›®å½•éå†å‡½æ•°
------

### opendir å‡½æ•°

**`DIR *opendir(const char *name);`**

*   **ä½œç”¨**ï¼šæ‰“å¼€ä¸€ä¸ªç›®å½•
*   **å‚æ•°**ï¼š `name`ï¼šéœ€è¦æ‰“å¼€çš„ç›®å½•çš„åç§°
*   **è¿”å›å€¼**ï¼šè¿”å› `DIR*` ç±»å‹çš„ç›®å½•æµ

### readdir å‡½æ•°

**`struct dirent *readdir(DIR *dirp);`**

*   **ä½œç”¨**ï¼šè¯»å–ç›®å½•ä¸­çš„ä¿¡æ¯
*   **å‚æ•°**ï¼š `dirp`ï¼šopendir è¿”å›çš„ç»“æœ
*   **è¿”å›å€¼**ï¼š`struct dirent*` ç±»å‹è¡¨ç¤ºå¦‚æœè¯»å–æˆåŠŸè¿”å› dirent ç»“æ„ä½“ï¼›å¦‚æœè¯»å–åˆ°çš„æ–‡ä»¶çš„ä¿¡æ¯è¯»å–åˆ°äº†æœ«å°¾æˆ–è€…å¤±è´¥äº†ï¼Œè¿”å› NULL

#### dirent ç»“æ„ä½“

```
struct dirent
{
    ino_t d_ino;                 // æ­¤ç›®å½•è¿›å…¥ç‚¹çš„inode
    off_t d_off;                 // ç›®å½•æ–‡ä»¶å¼€ä¹°è‡³æ­¤ç›®å½•è¿›å…¥ç‚¹çš„ä½ç§»
    unsigned short int d_reclen; // d_nameçš„é•¿åº¦ï¼Œä¸åŒ…å«NULLå­—ç¬¦
    unsigned char d_type;        // d_nameæ‰€æŒ‡çš„æ–‡ä»¶ç±»å‹
    char d_name[256];            // æ–‡ä»¶å
};

```

#### d_type å˜é‡

![](https://img-blog.csdnimg.cn/ef5bc4c21d03403fb5553e4c3d4f41e0.png)

### closedir å‡½æ•°

**`int closedir(DIR *dirp);`**

*   **ä½œç”¨**ï¼šå…³é—­ç›®å½•æŒ‡å®šç›®å½•
*   **å‚æ•°**ï¼š`dirp`ï¼šopendir è¿”å›çš„ç»“æœ
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å› 0ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

**ä»£ç ç¤ºä¾‹**

```
#define _DEFAULT_SOURCE
#include <sys/types.h>
#include <dirent.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

// è¯»å–æŸä¸ªç›®å½•ä¸‹æ‰€æœ‰çš„æ™®é€šæ–‡ä»¶çš„ä¸ªæ•°
int getFileNum(const char *path)
{
    // æ‰“å¼€ç›®å½•
    DIR *dir = opendir(path);
    if (dir == NULL)
    {
        perror("opendir");
        exit(0);
    }

    struct dirent *ptr;

    // è®°å½•æ™®é€šæ–‡ä»¶ä¸ªæ•°
    int total = 0;

    while ((ptr = readdir(dir)) != NULL)
    {
        // è·å–åç§°
        char *dname = ptr->d_name;
        // å¿½ç•¥æ‰ï¼å’Œ..
        if (strcmp(dname, ".") == 0 || strcmp(dname, "..") == 0)
        {
            continue;
        }
        // åˆ¤æ–­æ˜¯å¦æ˜¯æ™®é€šæ–‡ä»¶è¿˜æ˜¯ç›®å½•
        if (ptr->d_type == DT_DIR)
        {
            // ç›®å½•,éœ€è¦ç»§ç»­è¯»å–è¿™ä¸ªç›®å½•
            char newpath[256];
            sprintf(newpath, "%s/%s", path, dname);
            total += getFileNum(newpath);
        }

        if (ptr->d_type == DT_REG)
        {
            // æ™®é€šæ–‡ä»¶
            total++;
        }
    }
    // å…³é—­ç›®å½•
    closedir(dir);
    return total;
}

int main(int argc, char *argv[1])
{
    if (argc < 2)
    {
        printf("%s path\n", argv[0]);
        return -1;
    }
    int num = getFileNum(argv[1]);
    printf("æ™®é€šæ–‡ä»¶çš„ä¸ªæ•°ä¸º:%d\n", num);

    return 0;
}


```

![](https://img-blog.csdnimg.cn/47dfe00209704be8b4e7afb41aaaca77.png)

dupã€dup2 å‡½æ•°
-----------

**`int dup (int oldfd);`**

*   **ä½œç”¨**ï¼šå¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼ˆåŸæ–‡ä»¶æè¿°ç¬¦å’Œå¤åˆ¶æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶ï¼‰
*   **å‚æ•°**ï¼š `oldfd`ï¼šéœ€è¦å¤åˆ¶çš„æ–‡ä»¶æè¿°ç¬¦
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

**ä»£ç ç¤ºä¾‹**

```
#include <unistd.h>
#include <stdio.h>
#include <fcntl.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <string.h>

int main()
{
    int fd = open("a.txt", O_RDWR | O_CREAT, 0664);
    int fd1 = dup(fd);
    if (fd1 == -1)
    {
        perror("dup");
        return -1;
    }
    printf("fdï¼š%d\nfd1ï¼š%d\n", fd, fd1);
    close(fd);
    char *str = "hello,world";

    int ret = write(fd1, str, strlen(str));
    if (ret == -1)
    {
        perror("write");
        return -1;
    }
    close(fd1);
    return 0;
}

```

![](https://img-blog.csdnimg.cn/c3cf8db68fef497c9ab946cfeeda93b8.png)

**`int dup2 (int oldfd, int newfd);`**

*   **ä½œç”¨**ï¼šé‡å®šå‘æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¦‚ï¼š`oldfd` æŒ‡å‘ a.txtï¼Œ `newfd` æŒ‡å‘ b.txtï¼›è°ƒç”¨å‡½æ•°æˆåŠŸåï¼š`newfd` å’Œ b.txt åš `close`ï¼Œ`newfd` æŒ‡å‘äº† a.txtï¼‰
*   **å‚æ•°**ï¼š
    *   `oldfd`ï¼šåŸæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¿…é¡»æ˜¯æœ‰æ•ˆçš„ï¼‰
    *   `newfd`ï¼šå¯ä»¥é‡å®šå‘çš„æ–‡ä»¶æè¿°ç¬¦
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å›é‡å®šå‘çš„æ–‡ä»¶æè¿°ç¬¦ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

**ä»£ç ç¤ºä¾‹**

```
#include <unistd.h>
#include <stdio.h>
#include <fcntl.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <string.h>
int main()
{
    int fd = open("1.txt", O_RDWR | O_CREAT, 0664);
    if (fd == -1)
    {
        perror("open");
        return -1;
    }

    int fd1 = open("2.txt", O_RDWR | O_CREAT, 0664);
    if (fd1 == -1)
    {
        perror("open");
        return -1;
    }

    printf("fdï¼š%d\nfd1ï¼š%d\n", fd, fd1);

    int fd2 = dup2(fd, fd1);
    if (fd2 == -1)
    {
        perror("dup2");
        return -1;
    }

    // é€šè¿‡fd1å»å†™æ•°æ®ï¼Œå®é™…æ“ä½œçš„æ˜¯1.txtï¼Œè€Œä¸æ˜¯2.txt
    char *str = "hello, dup2";
    int len = write(fd1, str, strlen(str));

    printf("fdï¼š%d\nfd1ï¼š%d\nfd2ï¼š%d\n", fd, fd1, fd2);

    close(fd);
    close(fd1);
    // close(fd2); fd1ã€fd2æ–‡ä»¶æè¿°ç¬¦ç›¸åŒå¯é€‰ä¸€ä¸ªå…³

    return 0;
}

```

![](https://img-blog.csdnimg.cn/7c841caffd6c4acc966c93719c8a3d8a.png)

fcntl å‡½æ•°
--------

`int fcntl(int fd, int cmd, ...);`

*   **ä½œç”¨**ï¼šå¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ã€è®¾ç½®å’Œè·å–æ–‡ä»¶çŠ¶æ€æ ‡å¿—
*   **å‚æ•°**ï¼š
    *   `fd`ï¼šè¡¨ç¤ºéœ€è¦æ“ä½œçš„æ–‡ä»¶æè¿°ç¬¦
    *   `cmd`ï¼šè¡¨ç¤ºå¯¹æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå¦‚ä½•æ“ä½œ
        *   `F_DUPFD`ï¼šå¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤åˆ¶çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•° `fd`
        *   `F_GETFL`ï¼šè·å–æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦æ–‡ä»¶çŠ¶æ€ flag  
            è·å–çš„ flag å’Œæˆ‘ä»¬é€šè¿‡`open`å‡½æ•°ä¼ é€’çš„ flag æ˜¯ä¸€ä¸ªä¸œè¥¿
        *   `F_SETFL`ï¼šè®¾ç½®æ–‡ä»¶æè¿°ç¬¦æ–‡ä»¶çŠ¶æ€ flag  
            **å¿…é€‰é¡¹**ï¼š`O_RDONLY`ï¼Œ `O_WRONLY` ï¼Œ`O_RDWR` ï¼ˆä¸å¯ä»¥è¢«ä¿®æ”¹ï¼‰  
            **å¯é€‰é¡¹**ï¼š`O_APPEND` è¿½åŠ æ•°æ®ï¼Œ`O_NONBLOCK` è®¾ç½®éé˜»å¡ï¼ˆå¯ä»¥è¢«ä¿®æ”¹ï¼‰
*   **è¿”å›å€¼**ï¼šå¦‚æœæˆåŠŸè¿”å›é‡å®šå‘çš„æ–‡ä»¶æè¿°ç¬¦ï¼›å¦‚æœå¤±è´¥è¿”å› - 1 å¹¶è®¾ç½® errno

**ä»£ç ç¤ºä¾‹**

```
#include <unistd.h>
#include <fcntl.h>
#include <stdio.h>
#include <string.h>
int main()
{
    // 1.å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦
    int fd = open("1.txt", O_RDWR);
    // ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º0ï¼Œåˆ™ç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæœªä½¿ç”¨çš„æœ€å°æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå¤åˆ¶åçš„æ–‡ä»¶æè¿°ç¬¦ã€‚
    int fd1 = fcntl(fd, F_DUPFD, 0);

    printf("fdï¼š%d\nfd1ï¼š%d\n", fd, fd1);
    close(fd1);

    // 2.ä¿®æ”¹æˆ–è€…è·å–æ–‡ä»¶çŠ¶æ€flag
    if (fd == -1)
    {
        perror("open");
        return -1;
    }

    // 2.1.è·å–æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€flag
    int flag = fcntl(fd, F_GETFL);
    flag |= O_APPEND; // flag = flag | O_APPEND

    // 2.2.ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€çš„flagï¼Œç»™flagåŠ å…¥O_APPENDè¿™ä¸ªæ ‡è®°
    int ret = fcntl(fd, F_SETFL, flag);
    if (ret == -1)
    {
        perror("fcntl");
        return -1;
    }

    char *str = "nihao";

    write(fd, str, strlen(str));

    close(fd);

    return 0;
}


```

![](https://img-blog.csdnimg.cn/29829ec083cb42eb97f2fd1a2f63ff8c.png)

ç»“è¯­
--

è¯¾ç¨‹ç¬”è®°æºäºç‰›å®¢ C++ æ±‚èŒé¡¹ç›®ï¼š[https://www.nowcoder.com/courses/cover/live/504](https://www.nowcoder.com/courses/cover/live/504) çš„[ç¬¬ 1 ç«  Linux ç³»ç»Ÿç¼–ç¨‹å…¥é—¨](https://www.nowcoder.com/study/live/504/1/1)ã€‚  
æ­¤ç¬”è®°ç›¸å¯¹è¯¾ç¨‹å†…å®¹æœ‰å¢åˆ ä»…ä¸ªäººå¤ä¹ ç”¨ï¼Œè‹¥æœ‰éœ€è¦ä»…ä¾›å‚è€ƒã€‚ä»¥ä¸Šæ‰€æœ‰ä»£ç å’Œå›¾ç‰‡å‡ä¸ºè¯¾ç¨‹è‡ªå¸¦ä»¥åŠç½‘ç»œèµ„æºï¼Œæ¬¢è¿å„ä½å¤§ä½¬æå‡ºé—®é¢˜å’Œå»ºè®®ï¼Œæ­¤ç¬”è®°å®æ—¶æ›´æ–°ã€‚